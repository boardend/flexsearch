/**!
 * FlexSearch.js v0.7.0-beta (Compact)
 * Copyright 2019 Nextapps GmbH
 * Author: Thomas Wilkerling
 * Licence: Apache-2.0
 * https://github.com/nextapps-de/flexsearch
 */
(function(){'use strict';var w;function aa(a){function b(c){return a.next(c)}function d(c){return a.throw(c)}return new Promise(function(c,e){function g(f){f.done?c(f.value):Promise.resolve(f.value).then(b,d).then(g,e)}g(a.next())})};const x=/[\W_]+/;function ba(a){if(a=a.toLowerCase())if(a&&this.A&&(a=y(a,this.A)),this.C&&1<a.length&&(a=y(a,this.C)),a&&(x||""===x)&&(a=a.split(x),this.filter)){var b=this.filter;const d=a.length,c=[];for(let e=0,g=0;e<d;e++){const f=a[e];f&&!b[f]&&(c[g++]=f)}a=c}return a};function A(a,b){return"undefined"!==typeof a?a:b}function E(a){const b=Array(a);for(let d=0;d<a;d++)b[d]=G();return b}function G(){return Object.create(null)}function ca(a,b){return b.length-a.length}function H(a){return"string"===typeof a}function I(a){return"object"===typeof a}function J(a){return"function"===typeof a};function da(a,b){const d=Object.keys(a),c=d.length,e=[];let g="",f=0;for(let h=0,l,k;h<c;h++)l=d[h],(k=a[l])?(e[f++]=new RegExp(b?"(?!\\b)"+l+"(\\b|_)":l,"g"),e[f++]=k):g+=(g?"|":"")+l;g&&(e[f++]=new RegExp(b?"(?!\\b)("+g+")(\\b|_)":"("+g+")","g"),e[f]="");return e}function y(a,b){for(let d=0,c=b.length;d<c&&(a=a.replace(b[d],b[d+1]),a);d+=2);return a};const ea={},fa={};let ha=Promise;function ia(a){N(a,"add");N(a,"append");N(a,"search");N(a,"update");N(a,"remove")}function N(a,b){a[b+"Async"]=function(){const d=this,c=arguments;var e=c[c.length-1];let g;J(e)&&(g=e,delete c[c.length-1]);e=new ha(function(f){setTimeout(function(){const h=d[b];h.async=!0;f(h.apply(d,c));h.async=!1})});return g?(e.then(g),this):e}};function ja(a,b,d,c){const e=a.length;let g=[],f=G(),h=0;c&&(c=[]);for(let l=0;l<e;l++){const k=a[l],r=k.length,q=G();let t=!l;for(let m=0;m<r;m++){const v=k[m],p=v.length;if(p){c&&(c[m]=[]);for(let z=0,u=0,n;z<p;z++)if(n=v[z],!l)q[n]=1;else if(f[n]){if(l===e-1)if(d)d--;else{if(g[h++]=n,h===b)return g}else c&&u<b&&(c[m][u++]=n),q[n]=1;t=!0}}}if(!t&&!c)return[];f=q}if(c)for(let l=c.length-1,k,r;0<=l;l--)if(r=(k=c[l])&&k.length){if(h+r>=b)return g.concat(k.slice(0,b-h));g=g.concat(k);h+=r}return g}
;const ka={memory:{charset:"latin:extra",m:3,j:3,s:!1,l:"memory"},performance:{threshold:8,j:3,context:{depth:1,u:!0}},match:{charset:"latin:extra",H:"full",m:3},score:{charset:"latin:advanced",threshold:1,context:{depth:3,u:!0}},"default":{m:3,threshold:0,depth:3}};function O(a,b){if(!(this instanceof O))return new O(a);var d;let c;a?(H(a)?a=ka[a]:(d=a.preset)&&(a=Object.assign({},ka[d],a)),d=a.charset,c=a.lang,H(d)&&(-1===d.indexOf(":")&&(d+=":default"),d=fa[d]),H(c)&&(c=ea[c])):a={};let e,g,f,h=a.context||{};this.encode=a.encode||d&&d.encode||ba;this.register=b||G();e=a.resolution||9;g=a.threshold||0;g>=e&&(g=e-1);this.m=e;this.threshold=g;this.v=b=d&&d.H||a.tokenize||"strict";this.depth="strict"===b&&h.depth;this.u=A(h.bidirectional,!0);this.l=f="memory"===
a.optimize;this.s=A(a.fastupdate,!0);this.j=a.minlength||1;this.g=f?E(e-g):G();e=h.resolution||e;g=h.threshold||g;g>=e&&(g=e-1);this.h=e;this.o=g;this.i=f?E(e-g):G();this.B=d&&d.B||a.rtl;this.A=(b=a.matcher||c&&c.A)&&da(b,!1);this.C=(b=a.stemmer||c&&c.C)&&da(b,!0);if(a=b=a.filter||c&&c.filter){a=b;d=G();for(let l=0,k=a.length;l<k;l++)d[a[l]]=1;a=d}this.filter=a}w=O.prototype;w.append=function(a,b){return this.add(a,b,!0)};
w.add=function(a,b,d){if(this.register[a]&&!d)return this.update(a,b);if(b&&(a||0===a)){b=this.encode(b);const k=b.length;if(k){const r=this.depth,q=this.m-this.threshold,t=G(),m=G();for(let v=0;v<k;v++){let p=b[this.B?k-1-v:v];var c=p.length;if(p&&c>=this.j&&(r||!t[p])){var e=Math.min(this.m/k*v|0,v);if(e<q){var g="";switch(this.v){case "full":if(3<c){for(var f=0;f<c;f++){var h=f?Math.min(e/2+this.m/c*f/2|0,e+f):e;if(h<q)for(var l=c;l>f;l--)g=p.substring(f,l),g.length>=this.j&&P(this,t,g,h,a,d)}break}case "reverse":if(2<
c){for(f=c-1;0<f;f--)g=p[f]+g,g.length>=this.j&&P(this,t,g,e,a,d);g=""}case "forward":if(1<c)for(f=0;f<c;f++)g+=p[f],g.length>=this.j&&P(this,t,g,e,a,d);break;default:if(P(this,t,p,e,a,d),r&&1<k&&v<k-1)for(c=this.h-this.o,e=G(),g=p,f=Math.min(r+1,k-v),e[g]=1,h=1;h<f;h++)if((p=b[this.B?k-1-v-h:v+h])&&p.length>=this.j&&!e[p]){if(e[p]=1,l=Math.min((this.h-f)/k*v+h|0,v+(h-1)),l<c){const z=this.u&&p>g;P(this,m,z?g:p,l,a,d,z?p:g)}}else f=Math.min(f+1,k-v)}}}}this.s||(this.register[a]=1)}}return this};
function P(a,b,d,c,e,g,f){let h=f?a.i:a.g;if(!b[d]||f&&!b[d][f])a.l&&(h=h[c]),f?(b[d]||(b[d]=G()),b[d][f]=1,h=h[f]||(h[f]=G())):b[d]=1,h=h[d]||(h[d]=[]),a.l||(h=h[c]||(h[c]=[])),g&&-1!==h.indexOf(e)||(h[h.length]=e,a.s&&(a=a.register[e]||(a.register[e]=[]),a[a.length]=h))}
w.search=function(a,b,d){I(a)?(d=a,a=d.query):I(b)&&(d=b);let c=[],e;var g=this.threshold;let f,h=0;if(d){b=d.limit;h=d.offset||0;g=A(d.threshold,g);var l=d.context;f=d.suggest}if(a&&(a=this.encode(a),e=a.length,1<e)){d=G();var k=[];for(let q=0,t=0,m;q<e;q++)if((m=a[q])&&m.length>=this.j&&!d[m])if(this.l||f||this.g[m])k[t++]=m,d[m]=1;else return c;a=k;e=a.length}if(!e)return c;b||(b=100);d=this.m-g;g=this.h-g;l=this.depth&&1<e&&!1!==l;k=0;let r;l?(r=a[0],k=1):1<e&&a.sort(ca);for(let q,t;k<e;k++){t=
a[k];l?(q=la(this,c,f,g,b,2===e,t,r),f&&!1===q&&c.length||(r=t)):q=la(this,c,f,d,b,1===e,t);if(q)return q;if(f&&k===e-1){let m=c.length;if(!m){if(l){l=0;k=-1;continue}return c}if(1===m)return c=c[0],c=1===c.length?c[0]:[].concat.apply([],c),c.length>b?c.slice(0,b):c}}return ja(c,b,h,f)};function ma(a,b,d,c){d?(c=c&&b>d,a=(a=a[c?b:d])&&a[c?d:b]):a=a[b];return a}
function la(a,b,d,c,e,g,f,h){let l=[],k=h?a.i:a.g;a.l||(k=ma(k,f,h,a.u));if(k){let r=0;c=Math.min(k.length,c);for(let q=0,t=0,m;q<c&&!(m=k[q],a.l&&(m=ma(m,f,h,a.u)),m&&(l[r++]=m,g&&(t+=m.length,t>=e)));q++);if(r){if(g)return l=1===r?l[0]:[].concat.apply([],l),l.length>e?l.slice(0,e):l;b[b.length]=l;return}}return!d&&l}w.contain=function(a){return!!this.register[a]};w.update=function(a,b){return this.remove(a).add(a,b)};
w.remove=function(a,b){const d=this.register[a];if(d){if(this.s)for(let c=0,e;c<d.length;c++)e=d[c],e.splice(e.indexOf(a),1);else Q(this.g,a,this.m-this.threshold,this.l),this.depth&&Q(this.i,a,this.h-this.o,this.l);b||delete this.register[a]}return this};
function Q(a,b,d,c,e){let g=0;if(a.constructor===Array)if(e)b=a.indexOf(b),-1!==b?1<a.length&&(a.splice(b,1),g++):g++;else{e=Math.min(a.length,d);for(let f=0,h;f<e;f++)if(h=a[f])g=Q(h,b,d,c,e),c||g||delete a[f]}else for(let f in a)(g=Q(a[f],b,d,c,e))||delete a[f];return g}ia(O.prototype);let na=0;function R(a){if(I(a)){var b=a;a=0}J(b.encode)&&(b.encode=b.encode.toString());const d=this;this.id=a||na++;this.h=null;this.g=new Worker("worker.js",{type:"module"});this.g.onmessage=function(c){d.h(c.data)};this.g.postMessage({G:"create",options:b})}S("add");S("append");S("search");S("update");S("remove");
function S(a){R.prototype[a]=R.prototype[a+"Async"]=function(){const b=this,d=[].slice.call(arguments);var c=d[d.length-1];let e;J(c)&&(e=c,d.splice(d.length-1,1));c=new ha(function(g){b.g.postMessage({G:a,I:d});"search"===a?b.h=g:g()});return e?(c.then(e),this):c}};function T(a){if(!(this instanceof T))return new T(a);var b;a||(a={});this.D=[];this.g=[];this.o=[];this.register=G();this.key=(b=a.key)&&U(b,this.o)||"id";this.s=A(a.fastupdate,!0);this.store=(b=a.store)&&G();this.h=b&&!0!==b&&[];this.async=!1;b=a;a=G();let d=b.doc;if(H(d))d=[d];else if(d.constructor!==Array){var c=d;d=Object.keys(d)}for(let e=0,g,f;e<d.length;e++)g=d[e],H(g)?c&&(f=c[g]):(f=g,g=g.field),f=I(f)?Object.assign({},b,f):b,a[g]=this.v?new R(f):new O(f,this.register),this.D[e]=U(g,this.o),
this.g[e]=g;if(this.h)for(c=b.store,H(c)&&(c=[c]),b=0;b<c.length;b++)this.h[b]=U(c[b],this.o);this.i=a}function U(a,b){const d=a.split(":");let c=0;for(let e=0;e<d.length;e++)a=d[e],0<=a.indexOf("[]")&&(a=a.substring(0,a.length-2))&&(b[c]=!0),a&&(d[c++]=a);c<d.length&&(d.length=c);return 1<c?d:d[0]}function Y(a,b,d,c,e){a=a[e];if(c===d.length-1)b[e]=a;else if(a)if(a.constructor===Array)for(b=b[e]=Array(a.length),e=0;e<a.length;e++)Y(a,b,d,c,e);else b=b[e]||(b[e]=G()),e=d[++c],Y(a,b,d,c,e)}
function Z(a,b,d,c,e,g,f,h){a=a[f];if(c===b.length-1){if(a.constructor===Array){if(d[c]){for(b=0;b<a.length;b++)e.add(g,a[b],!0);return}a=a.join(" ")}e.add(g,a,h)}else if(a)if(a.constructor===Array)for(f=0;f<a.length;f++)Z(a,b,d,c,e,g,f,h);else f=b[++c],Z(a,b,d,c,e,g,f,h)}w=T.prototype;
w.add=function(a,b,d){if(I(a)){a=b=a;var c=this.key;if(H(c))a=a[c];else for(let e=0;a&&e<c.length;e++)a=a[c[e]]}if(b&&(a||0===a)){if(this.register[a])return this.update(a,b);for(let e=0,g,f;e<this.g.length;e++)f=this.g[e],g=this.D[e],H(g)&&(g=[g]),Z(b,g,this.o,0,this.i[f],a,g[0],d);if(this.store){let e;if(this.h){e=G();for(let g=0,f;g<this.h.length;g++)f=this.h[g],H(f)?e[f]=b[f]:Y(b,e,f,0,f[0])}this.store[a]=e||b}}return this};w.append=function(a,b){return this.add(a,b,!0)};
w.update=function(a,b){return this.remove(a).add(a,b)};w.remove=function(a){I(a)&&(a=a[this.key]);if(this.register[a]){for(let b=0;b<this.g.length&&(this.i[this.g[b]].remove(a,!0),!this.s||this.v);b++);this.store&&delete this.store[a];delete this.register[a]}return this};
w.search=function(a,b,d){const c=this;return aa(function*(){I(a)?(d=a,a=d.query):I(b)&&(d=b,b=0);let e=[];var g=[],f;let h;let l,k,r,q,t=0;if(d)if(d.constructor===Array){var m=d;d=null}else if(m=(f=d.pluck)||d.field||d.doc,k=!1,h=c.store&&d.enrich,r="and"===d.bool,b=d.limit||100,q=d.offset||0,m&&(H(m)?m=[m]:m.constructor!==Array&&(l=m,m=Object.keys(m))),k&&(H(k)&&(k=[k]),!a)){for(let u=0,n;u<k.length;u++){g=k[u];if((m=(f=c.F[g])&&f.length-q)&&0<m){if(m>b||q)f=f.slice(q,q+b);h&&(f=oa.call(c,f));n=
{tag:g,result:f}}else n=void 0;n&&(e[e.length]=n,t++)}return t?e:[]}m||(m=c.g);r=r&&(1<m.length||k&&1<k.length);let v=[];if(c.v||c.async){for(let u=0,n;u<m.length;u++){var p=void 0;n=m[u];H(n)?l&&(p=l[n]):(p=n,n=n.field);v[u]=c.i[n].searchAsync(a,b,p||d)}v=yield Promise.all(v)}for(let u=0,n,B,K;u<m.length;u++){let V;B=m[u];H(B)?l&&(V=l[B]):(V=B,B=B.field);n=c.v||c.async?v[u]:c.i[B].search(a,b,V||d);K=n.length;if(k&&K){var z=[];p=0;r&&(z[0]=[n]);for(let F=0,L,C;F<k.length;F++)if(L=k[F],K=(C=c.F[L])&&
C.length)p++,z[z.length]=r?[C]:C;if(p){if(r)p=ja(z,b||100,q||0);else{p=n;const F=G(),L=G(),C=[];for(let D=0;D<p.length;D++)F[p[D]]=1;for(let D=0,W;D<z.length;D++){W=z[D];for(let X=0,M;X<W.length;X++)M=W[X],F[M]&&!L[M]&&(L[M]=1,C[C.length]=M)}p=C}n=p;K=n.length}}if(K)g[t]=B,e[t++]=n;else if(r)return[]}if(!t)return[];if(f&&(!h||!c.store))return e[0];for(let u=0,n;u<g.length;u++){n=e[u];n.length&&h&&(n=oa.call(c,n));if(f)return n;e[u]={field:g[u],result:n}}return e}())};
function oa(a){const b=Array(a.length);for(let d=0,c;d<a.length;d++)c=a[d],b[d]={key:c,doc:this.store[c]};return b}w.contain=function(a){return!!this.register[a]};w.get=function(a){return this.store[a]};w.set=function(a,b){this.store[a]=b;return this};ia(T.prototype);window.FlexSearch={Index:O,Document:T,registerCharset:function(a,b){fa[a]=b},registerLanguage:function(a,b){ea[a]=b}};}).call(this);
